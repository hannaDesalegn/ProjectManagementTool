
generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum WorkspaceType {
  PERSONAL
  TEAM
  ORGANIZATION
}

enum MembershipRole {
  Owner
  Admin
  Member
  Viewer
}

enum ProjectStatus {
  Active
  Archived
  Completed
}

enum CardStatus {
  ToDo
  InProgress
  Done
}

model Users {
  id            String          @id @default(uuid()) @db.Uuid
  name          String
  email         String          @unique
  password_hash String
  profile_pic   String
  created_at    DateTime        @default(now())
  deleted_at    DateTime?

  owned_workspaces Workspaces[] @relation("WorkspaceOwner")
  memberships      Memberships[]
  assigned_cards   Cards[]       @relation("UserAssignedCards")
  activity_logs    ActivityLogs[]
}

model Workspaces {
  id          String        @id @default(uuid()) @db.Uuid
  name        String
  type        WorkspaceType
  owner_id    String        @db.Uuid
  verified    Boolean
  created_at  DateTime      @default(now())
  deleted_at  DateTime?

  owner       Users         @relation("WorkspaceOwner", fields: [owner_id], references: [id], onDelete: Cascade)
  memberships Memberships[]
  projects    Projects[]
  boards      Boards[]
  cards       Cards[]
}

model Memberships {
  id           String      @id @default(uuid()) @db.Uuid
  user_id      String      @db.Uuid
  workspace_id String      @db.Uuid
  role         MembershipRole
  joined_at    DateTime    @default(now())
  left_at      DateTime?

  user      Users      @relation(fields: [user_id], references: [id], onDelete: Cascade)
  workspace Workspaces @relation(fields: [workspace_id], references: [id], onDelete: Cascade)

  @@unique([user_id, workspace_id])
  @@index([workspace_id])
  @@index([user_id])
}

model Projects {
  id           String      @id @default(uuid()) @db.Uuid
  workspace_id String      @db.Uuid
  name         String
  description  String?     @db.Text
  status       ProjectStatus
  start_date   DateTime    @db.Date
  end_date     DateTime    @db.Date
  created_at   DateTime    @default(now())
  deleted_at   DateTime?

  workspace Workspaces @relation(fields: [workspace_id], references: [id], onDelete: Cascade)
  boards    Boards[]

  @@index([workspace_id])
}

model Boards {
  id           String    @id @default(uuid()) @db.Uuid
  project_id   String    @db.Uuid
  workspace_id String    @db.Uuid
  name         String
  created_at   DateTime  @default(now())

  project   Projects   @relation(fields: [project_id], references: [id], onDelete: Cascade)
  workspace Workspaces @relation(fields: [workspace_id], references: [id], onDelete: Cascade)
  lists     Lists[]
  cards     Cards[]

  @@index([project_id])
  @@index([workspace_id])
}

model Lists {
  id         String   @id @default(uuid()) @db.Uuid
  board_id   String   @db.Uuid
  name       String
  position   Float
  created_at DateTime @default(now())
  deleted_at DateTime?

  board Boards @relation(fields: [board_id], references: [id], onDelete: Cascade)
  cards Cards[]

  @@index([board_id])
}

model Cards {
  id           String        @id @default(uuid()) @db.Uuid
  list_id      String        @db.Uuid
  board_id     String        @db.Uuid
  workspace_id String        @db.Uuid
  title        String
  description  String        @db.Text
  status       CardStatus
  assigned_to  String?       @db.Uuid
  created_at   DateTime      @default(now())
  deleted_at   DateTime?

  list          Lists      @relation(fields: [list_id], references: [id], onDelete: Cascade)
  board         Boards     @relation(fields: [board_id], references: [id], onDelete: Cascade)
  workspace     Workspaces @relation(fields: [workspace_id], references: [id], onDelete: Cascade)
  assignee      Users?     @relation("UserAssignedCards", fields: [assigned_to], references: [id], onDelete: SetNull)
  activity_logs ActivityLogs[]

  @@index([list_id])
  @@index([board_id])
  @@index([workspace_id])
  @@index([assigned_to])
}

model ActivityLogs {
  id         String   @id @default(uuid()) @db.Uuid
  user_id    String   @db.Uuid
  card_id    String   @db.Uuid
  action     String
  created_at DateTime @default(now())

  user Users @relation(fields: [user_id], references: [id], onDelete: Cascade)
  card Cards @relation(fields: [card_id], references: [id], onDelete: Cascade)

  @@index([user_id])
  @@index([card_id])
}
